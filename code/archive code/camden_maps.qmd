---
title: "camden_maps"
format: html
---

```{r load data}

library(tidyverse)
library(ggplot2)
library(leaflet)
library(leaflet.extras)
library(readr)
library(sf)
library(here)
library(dplyr)
library(tidycensus)
census_api_key("0702f85699449016b5b9de6482e5cc397e53b3fe", overwrite = TRUE)

# readRDS(here::here("data", "camden_clean.rds"))

# readRDS(here::here("data", "philly_clean.rds"))

```

```{r filtered}

camden_bounds <- c(lat_min = 39.875, lat_max = 39.961,
                   lng_min = -75.137, lng_max = -75.045)

camden_clean <- camden_clean |> 
  filter(!is.na(lat) & !is.na(lng)) |> 
  filter(lat >= camden_bounds["lat_min"] & lat <= camden_bounds["lat_max"] &
         lng >= camden_bounds["lng_min"] & lng <= camden_bounds["lng_max"])

philly_bounds <- c(lat_min = 39.8719, lat_max = 40.1375,
                   lng_min = -75.0426, lng_max = -75.2479)

philly_clean <- philly_clean |> 
  filter(!is.na(lat) & !is.na(lng)) |> 
  filter(lat >= philly_bounds["lat_min"] & lat <= philly_bounds["lat_max"] &
         lng >= philly_bounds["lng_min"] & lng <= philly_bounds["lng_max"])

```

```{r test maps}

#dots
leaflet() |> 
  addTiles() |> 
  addCircleMarkers(
    data = camden_clean,
    lng = ~lng, 
    lat = ~lat, 
    radius = 2, 
    fillOpacity = 0.5
    )







```





```{r census}

#sample map by median household income
camden_income <- get_acs(geography = "tract",
                         variables = "B06011_001",
                         state = "NJ",
                         county = "Camden",
                         geometry = TRUE)


ggplot() +
  geom_sf(data = camden_income, aes(fill = estimate)) +
  theme_minimal() +
  labs(title = "Median Household Income in Camden County, NJ",
       fill = "Median Income")

camden_white <- get_decennial(geography = "tract",
                              variables = "P1_003N",
                              state = "NJ",
                              county = "Camden",
                              geometry = TRUE) 

ggplot() +
  geom_sf(data = camden_white, aes(fill = value)) +
  theme_minimal() +
  labs(title = "White Population in Camden County, NJ",
       fill = "White Population Estimate")

camden_black <- get_decennial(geography = "tract",
                              variables = "P1_004N",
                              state = "NJ",
                              county = "Camden",
                              geometry = TRUE)

ggplot() +
  geom_sf(data = camden_black, aes(fill = value)) +
  theme_minimal() +
  labs(title = "Black Population in Camden County, NJ",
       fill = "Black Population Estimate")

camden_asian <- get_decennial(geography = "tract",
                              variables = "P1_006N",
                              state = "NJ",
                              county = "Camden",
                              geometry = TRUE)

ggplot() +
  geom_sf(data = camden_black, aes(fill = value)) +
  theme_minimal() +
  labs(title = "Asian Population in Camden County, NJ",
       fill = "Asian Population Estimate")

```

```{r census data}

options(tigris_use_cache = TRUE)

race_variables <- load_variables(2020, "pl", cache = TRUE)
view(race_variables)

#P1_003N white only
#P1_004N black only
# P1_006N asian only

income_variables <- load_variables(2020, "acs5")
view(income_variables)

#B06011_001 median income in the last 12 months

```

```{r tract test}

library(mapview)
library(tigris) 

camden_tracts <- tracts("NJ", "Camden")
mapview(camden_tracts)

tracts_to_include <- c(600200, 600400, 600700, 600800, 600900, 601000, 601101, 
                       601102, 601200, 601300, 601400, 601500, 601600, 601700, 
                       601800, 601900, 602000, 610300, 610400)

camden_tracts_subset <- camden_tracts[camden_tracts$TRACT %in% tracts_to_include, ]

mapview(camden_tracts_subset)


```


